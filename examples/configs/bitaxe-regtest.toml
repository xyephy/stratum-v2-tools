# =============================================================================
# Bitaxe + Regtest Quick Start Configuration
# =============================================================================
# USE CASE: Solo mining with a single Bitaxe on local regtest network
# DIFFICULTY: Easiest - perfect for testing and development
# TIME TO MINE: 5 minutes setup, blocks found within seconds on regtest
#
# WHAT YOU NEED:
# 1. Bitcoin Core v30+ running with: bitcoind -regtest -rpcuser=sv2user -rpcpassword=sv2pass123
# 2. This config file
# 3. Bitaxe on same network
#
# EXPECTED OUTPUT:
#   ✅ sv2d starts all components automatically
#   ✅ Bitaxe connects within 30 seconds
#   ✅ Blocks found almost immediately (regtest has low difficulty)
#
# TROUBLESHOOTING:
#   - If Bitcoin Core connection fails: Check it's running with correct RPC credentials
#   - If Bitaxe won't connect: Check it's pointed to YOUR_IP:3333
#   - If no blocks found: Run `bitcoin-cli -regtest generatetoaddress 1 <address>` to lower difficulty
# =============================================================================

[mode]
# Solo mining mode - you keep 100% of block rewards
type = "Solo"

[mode.config]
# WHERE BLOCK REWARDS GO
# Generate a new address with: bitcoin-cli -regtest getnewaddress
# IMPORTANT: Save this address - this is where your mining rewards will be sent!
coinbase_address = "bcrt1qe8le5cgtujqrx9r85e8q4r6zjy4c227zhgtyea"

# HOW OFTEN TO CHECK FOR NEW TRANSACTIONS (seconds)
# Lower = more frequent template updates = slightly higher chance of including new transactions
# Higher = less CPU/network overhead
# Recommendation: 30 seconds is fine for regtest
block_template_refresh_interval = 30

# CUSTOM TRANSACTION SELECTION
# false = use Bitcoin Core's transaction selection (recommended for beginners)
# true = select your own transactions (advanced feature, requires Job Declarator)
enable_custom_templates = false

# HOW LONG TO USE OLD TEMPLATES (seconds)
# If Bitcoin Core is slow to respond, how long should we keep using the old template?
# Recommendation: 300 seconds (5 minutes) is safe
max_template_age = 300

[network]
# WHERE MINERS CONNECT
# 0.0.0.0:3333 = listen on all network interfaces, standard Stratum port
# Change to 127.0.0.1:3333 if you only want local connections
# BITAXE USERS: Point your Bitaxe to YOUR_COMPUTER_IP:3333
bind_address = "0.0.0.0:3333"

# MAXIMUM SIMULTANEOUS MINER CONNECTIONS
# How many miners can connect at once?
# For home mining: 10 is plenty (you probably have 1-3 miners)
# For small pool: increase to 100
max_connections = 10

# CONNECTION TIMEOUT (seconds)
# How long to wait before considering a connection dead?
# Recommendation: 30 seconds is standard
connection_timeout = 30

# KEEPALIVE INTERVAL (seconds)
# How often to ping miners to keep connection alive?
# Recommendation: 60 seconds prevents router/firewall timeouts
keepalive_interval = 60

[bitcoin]
# BITCOIN CORE CONNECTION
# This is how sv2d talks to your Bitcoin node
rpc_url = "http://127.0.0.1:18443"  # Regtest default RPC port

# RPC CREDENTIALS
# These MUST match what you started bitcoind with
# Example: bitcoind -regtest -rpcuser=sv2user -rpcpassword=sv2pass123
rpc_user = "sv2user"
rpc_password = "sv2pass123"

# NETWORK TYPE
# Must match your Bitcoin Core network
# Options: "Mainnet", "Testnet", "Signet", "Regtest"
network = "Regtest"

# BLOCK TEMPLATE REQUEST TIMEOUT (seconds)
# How long to wait for Bitcoin Core to generate a block template?
# Recommendation: 30 seconds is usually enough, increase if Bitcoin Core is slow
block_template_timeout = 30

# FEE-DELTA THRESHOLD (satoshis)
# Only generate new templates if fees changed by at least this much
# Prevents excessive updates during fee volatility
# Borrowed from Sjors' sv2-workshop best practices
# Recommendation: 1 satoshi for regtest (fees are negligible)
#                100 satoshis for mainnet (reduces noise)
fee_delta = 1

[database]
# WHERE TO STORE MINING DATA
# SQLite (single file, no setup needed) vs PostgreSQL (production-grade)
# For home/testing: SQLite is perfect
# Format: sqlite://filename.db or postgres://user:pass@host/database
url = "sqlite://sv2d_bitaxe_regtest.db"

# DATABASE CONNECTION POOL
# How many simultaneous database connections to maintain?
# For home mining: 10 is plenty
max_connections = 10
connection_timeout = 30

# AUTO-MIGRATE DATABASE SCHEMA
# true = automatically update database schema when sv2d version changes (recommended)
# false = manual migration required (advanced users only)
enable_migrations = true

[monitoring]
# METRICS AND MONITORING
# Enable Prometheus-style metrics for monitoring your mining operation
enable_metrics = true
metrics_bind_address = "0.0.0.0:9090"  # Access metrics at http://YOUR_IP:9090/metrics

# HEALTH CHECKS
# Periodic checks to ensure everything is working
enable_health_checks = true
health_check_interval = 30  # Check every 30 seconds

[monitoring.metrics]
enabled = true
collection_interval = 10  # Collect metrics every 10 seconds
prometheus_port = 9090
system_monitoring = true  # Monitor CPU, memory, etc.

[monitoring.health.alert_thresholds]
# ALERT THRESHOLDS
# Get warned when metrics exceed these values
cpu_usage = 80.0          # Warn if CPU usage exceeds 80%
memory_usage = 85.0       # Warn if memory usage exceeds 85%
connection_count = 9      # Warn if connections approach max (90% of max_connections)
rejection_rate = 10.0     # Warn if >10% of shares are rejected
response_time = 5000      # Warn if response time exceeds 5 seconds
database_connections = 8  # Warn if DB connections approach max

[logging]
# LOG VERBOSITY
# Levels: "trace", "debug", "info", "warn", "error"
# Recommendation: "info" for normal operation, "debug" for troubleshooting
level = "info"

# LOG FORMAT
# Pretty = colored, human-readable logs (good for console)
# JSON = machine-readable logs (good for log aggregation tools)
format = "Pretty"

# LOG OUTPUT
# Stdout = print to console
# File = write to log file
output = "Stdout"

# LOG FEATURES
enable_correlation_ids = true   # Track requests across components
redact_sensitive_data = true    # Hide passwords/keys in logs

[security]
# AUTHENTICATION
# false = no authentication required (fine for local network)
# true = require authentication (recommended if exposing to internet)
enable_authentication = false

# RATE LIMITING
# Prevent abuse by limiting requests per minute
rate_limit_per_minute = 60

# TLS/SSL ENCRYPTION
# false = unencrypted connections (fine for local network)
# true = encrypted connections (recommended for internet-facing)
enable_tls = false

[security.auth]
enabled = false
session_timeout = 3600  # Sessions expire after 1 hour
max_sessions_per_key = 10
require_auth_for_read = false

# =============================================================================
# NEXT STEPS AFTER SAVING THIS CONFIG:
# 1. Start Bitcoin Core:
#    bitcoind -regtest -rpcuser=sv2user -rpcpassword=sv2pass123
#
# 2. Generate some blocks to lower difficulty:
#    bitcoin-cli -regtest generatetoaddress 200 bcrt1qe8le5cgtujqrx9r85e8q4r6zjy4c227zhgtyea
#
# 3. Start sv2d with this config:
#    sv2-cli start --config examples/configs/bitaxe-regtest.toml
#
# 4. Check status:
#    sv2-cli status
#    You should see:
#      ✅ Bitcoin Core connected
#      ✅ Template Provider running
#      ✅ Pool listening on 0.0.0.0:3333
#      ✅ Translator ready for SV1 miners
#
# 5. Configure your Bitaxe:
#    - Pool URL: http://YOUR_COMPUTER_IP:3333
#    - Worker: bitaxe_1 (or any name you want)
#    - Password: x (doesn't matter for solo mining)
#
# 6. Watch the magic happen:
#    sv2-cli status --follow
#    You should see blocks being found within seconds!
# =============================================================================
